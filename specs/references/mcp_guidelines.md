# 參考：MCP 高效執行指南

本文件摘要自 Anthropic 的 [Code execution with MCP](https://www.anthropic.com/engineering/code-execution-with-mcp)，旨在指導 AI 如何更有效率地執行任務，減少 token 消耗並提升複雜邏輯的處理能力。

## 核心原則

傳統的「工具呼叫 (Tool-Calling)」模式會將大量工具定義和中間結果塞入上下文 (Context)，導致效率低落。MCP (Model-Code-Predict) 模式將 AI 視為一個能夠**撰寫並執行程式碼**的代理，從而克服這些限制。

## 關鍵實踐

1.  **將工具視為 API，而非函式**:
    *   **舊方法**: `use_tool("search", query="...")`
    *   **新方法**: 撰寫 Python 程式碼來呼叫 `google_web_search(...)`。這使得 AI 可以使用迴圈、條件判斷、錯誤處理等程式語言特性來設計更複雜的執行流程。

2.  **在執行環境中處理資料**:
    *   **問題**: 搜尋結果可能非常龐大，直接回傳給模型會佔用大量 token。
    *   **解決方案**: 在程式碼中直接處理和過濾資料。例如，在獲取大量搜尋結果後，先在程式碼中進行分析和摘要，只將最重要的資訊（如 Top 3 菜色、平均價格）回傳給模型做最終決策。

3.  **按需載入與技能建立**:
    *   **動態載入**: 不需要一次性了解所有可用的工具。可以透過 `search_tools` 或探索檔案系統來動態發現和載入所需工具。
    *   **技能固化**: 對於常用的程式碼邏輯（例如，從一堆食記中提取菜名和價格），可以將其儲存為一個可重複使用的函式（技能），供未來直接呼叫。

## 對本專案的應用

*   在 `_search_restaurant_info` 後，不要立即將所有原始文本拋回給模型。應該在程式碼層面進行預處理，提取出候選菜色、價格範圍等關鍵資訊。
*   複雜的飲食偏好邏輯（如 `_apply_dietary_rules`）應完全在 Python 程式碼中實現，利用 `if/else` 和迴圈，而不是讓模型在上下文中進行繁瑣的推理。
