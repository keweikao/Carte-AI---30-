# è¦æ ¼æ–‡ä»¶ï¼šAgent ç„¦é»å¼ Loading ç•«é¢

## 1. éœ€æ±‚èƒŒæ™¯

### å•é¡Œæè¿°
ç¾æœ‰çš„ Loading ç•«é¢ï¼ˆ`GamifiedLoadingState`ï¼‰é›–ç„¶æœ‰é€²åº¦æ¢å’Œå°çŸ¥è­˜ï¼Œä½†ç¼ºä¹ã€Œå¯è§£é‡‹æ€§ã€ï¼š
- ä½¿ç”¨è€…ä¸çŸ¥é“ AI æ­£åœ¨åšä»€éº¼
- ç­‰å¾…éç¨‹ç¼ºä¹åƒèˆ‡æ„Ÿ
- ç„¡æ³•å±•ç¾ Multi-Agent ç³»çµ±çš„åƒ¹å€¼

### è¨­è¨ˆç†å¿µ
**ã€Œè®“ä½¿ç”¨è€…çœ‹åˆ° AI å°ˆå®¶åœ˜éšŠæ­£åœ¨ç‚ºä»–å·¥ä½œã€**

å°‡å¾Œç«¯çš„ Multi-Agent æ¶æ§‹å…·è±¡åŒ–ç‚ºã€Œç„¦é»å¡ç‰‡ã€ï¼Œä¸€æ¬¡å±•ç¤ºä¸€å€‹ Agent çš„å·¥ä½œç‹€æ…‹ï¼Œæ­é…çœŸå¯¦çš„å¾Œç«¯ Logï¼Œè®“ç­‰å¾…æ™‚é–“è®Šæˆã€ŒShow Timeã€ã€‚

---

## 2. åŠŸèƒ½è¦æ ¼

### 2.1 è¦–è¦ºè¨­è¨ˆ

#### ç•«é¢ä½ˆå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚            ğŸ‘‚                        â”‚  â† Agent Icon (80x80)
â”‚       ReviewAgent                    â”‚  â† Agent åç¨±
â”‚       è©•è«–åˆ†æå°ˆå®¶                    â”‚  â† è·ç¨±
â”‚                                      â”‚
â”‚   [å‘¼å¸ç‡ˆå‹•ç•«]                        â”‚  â† è¡¨ç¤ºæ­£åœ¨å·¥ä½œ
â”‚                                      â”‚
â”‚   æ­£åœ¨åˆ†æ 446 å‰‡ Google è©•è«–...     â”‚  â† çœŸå¯¦ Log (è¡Œ1)
â”‚   å·²è™•ç† 234 å‰‡ï¼Œç™¼ç¾ 23 æ¬¡ã€Œå¿…é»ã€   â”‚  â† çœŸå¯¦ Log (è¡Œ2)
â”‚   éæ¿¾æ‰ 12 å‰‡ç–‘ä¼¼æ¥­é…æ–‡...          â”‚  â† çœŸå¯¦ Log (è¡Œ3)
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ æ‚¨çŸ¥é“å—ï¼Ÿ                        â”‚
â”‚                                      â”‚
â”‚ åœ¨æ—¥æœ¬ï¼Œåƒæ‹‰éºµæ™‚ç™¼å‡ºè²éŸ³æ˜¯ä¸€ç¨®       â”‚  â† trivia.ts å…§å®¹
â”‚ ç¦®è²Œï¼Œè¡¨ç¤ºå°å»šå¸«çš„è®šç¾ã€‚é€™å€‹ç¿’æ…£     â”‚  â† æ¯ 5 ç§’è‡ªå‹•åˆ‡æ›
â”‚ æºè‡ªæ–¼æ±Ÿæˆ¶æ™‚ä»£...                    â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¨­è¨ˆåŸå‰‡
- **æ¥µç°¡ä¸»ç¾©**ï¼šåªæœ‰ 2 å€‹å€å¡Šï¼Œä¸è¦éå¤šè³‡è¨Š
- **ç„¦é»æ˜ç¢º**ï¼šä¸€æ¬¡åªçœ‹ä¸€å€‹ Agent
- **çœŸå¯¦æ„Ÿ**ï¼šé¡¯ç¤ºå¾Œç«¯çœŸå¯¦çš„ Logï¼Œä¸æ˜¯å‡çš„é€²åº¦
- **æ•™è‚²æ€§**ï¼šåˆ©ç”¨ç­‰å¾…æ™‚é–“å­¸ç¿’é¤é£²çŸ¥è­˜

---

### 2.2 Agent é…ç½®

| Agent | Icon | è·ç¨± | é æœŸå·¥ä½œæ™‚é–“ |
|-------|------|------|-------------|
| **VisualAgent** | ğŸ“· | èœå–®æƒæå°ˆå®¶ | 2-4 ç§’ |
| **ReviewAgent** | ğŸ‘‚ | è©•è«–åˆ†æå°ˆå®¶ | 3-6 ç§’ |
| **SearchAgent** | ğŸ•µï¸ | é£Ÿè¨˜åµæ¢ | 2-4 ç§’ |
| **Orchestrator** | ğŸ§  | æ±ºç­–å¤§å¸« | 3-5 ç§’ |

**ç¸½è¨ˆ**ï¼š10-19 ç§’ï¼ˆå¹³å‡ 15 ç§’ï¼‰

---

### 2.3 å¾Œç«¯ Log æ ¼å¼

#### è³‡æ–™çµæ§‹
```json
{
  "current_agent": "ReviewAgent",
  "current_step": 2,
  "total_steps": 4,
  "logs": [
    "æ­£åœ¨åˆ†æ 446 å‰‡ Google è©•è«–...",
    "å·²è™•ç† 234 å‰‡ï¼Œç™¼ç¾ 23 æ¬¡ã€Œå¿…é»ã€",
    "éæ¿¾æ‰ 12 å‰‡ç–‘ä¼¼æ¥­é…æ–‡..."
  ],
  "timestamp": "2025-11-29T10:00:00Z"
}
```

#### Log æ›´æ–°ç­–ç•¥
- **VisualAgent**: æ¯è™•ç† 10 å¼µç…§ç‰‡æ¨é€ä¸€æ¬¡
- **ReviewAgent**: æ¯è™•ç† 50 å‰‡è©•è«–æ¨é€ä¸€æ¬¡
- **SearchAgent**: æ¯æ‰¾åˆ° 1 ç¯‡é£Ÿè¨˜æ¨é€ä¸€æ¬¡
- **Orchestrator**: æ¯å®Œæˆä¸€å€‹å„ªåŒ–æ­¥é©Ÿæ¨é€ä¸€æ¬¡

---

### 2.4 åˆ‡æ›é‚è¼¯

#### ç‹€æ…‹æ©Ÿ
```
[VisualAgent å·¥ä½œä¸­]
    â†“ (å®Œæˆ)
[åˆ‡æ›å‹•ç•« 0.5s]
    â†“
[ReviewAgent å·¥ä½œä¸­]
    â†“ (å®Œæˆ)
[åˆ‡æ›å‹•ç•« 0.5s]
    â†“
[SearchAgent å·¥ä½œä¸­]
    â†“ (å®Œæˆ)
[åˆ‡æ›å‹•ç•« 0.5s]
    â†“
[Orchestrator å·¥ä½œä¸­]
    â†“ (å®Œæˆ)
[è·³è½‰åˆ°æ¨è–¦çµæœé ]
```

#### åˆ‡æ›å‹•ç•«
- **æ»‘å‡º**ï¼šç•¶å‰å¡ç‰‡å‘å·¦æ»‘å‡ºä¸¦æ·¡å‡º
- **æ»‘å…¥**ï¼šä¸‹ä¸€å¼µå¡ç‰‡å¾å³æ»‘å…¥ä¸¦æ·¡å…¥
- **æ™‚é•·**ï¼š500ms

---

### 2.5 å°çŸ¥è­˜è¼ªæ’­

#### è³‡æ–™ä¾†æº
ä½¿ç”¨ç¾æœ‰çš„ `frontend/src/data/trivia.ts`ï¼ˆ196 å‰‡å„åœ‹é¤é£²å°çŸ¥è­˜ï¼‰

#### è¼ªæ’­ç­–ç•¥
- **åˆ‡æ›é–“éš”**ï¼š5 ç§’
- **é¸æ“‡æ–¹å¼**ï¼šéš¨æ©ŸæŠ½å–ï¼Œä¸é‡è¤‡ï¼ˆç›´åˆ°å…¨éƒ¨çœ‹å®Œï¼‰
- **å‹•ç•«**ï¼šæ·¡å…¥æ·¡å‡º

---

## 3. æŠ€è¡“å¯¦ä½œ

### 3.1 å¾Œç«¯æ”¹é€ 

#### ä¿®æ”¹æª”æ¡ˆ
- `agent/profile_agent.py`
- `main.py`

#### æ–°å¢ API
```python
@app.get("/v2/recommendations/progress/{job_id}")
async def get_recommendation_progress(job_id: str):
    """æŸ¥è©¢æ¨è–¦ç”Ÿæˆé€²åº¦ï¼ˆPolling ç”¨ï¼‰"""
    doc = db.collection("recommendation_jobs").document(job_id).get()
    if not doc.exists:
        raise HTTPException(404, "Job not found")
    return doc.to_dict()
```

#### Firestore Schema
**Collection**: `recommendation_jobs`  
**Document ID**: `{job_id}`

```json
{
  "status": "processing" | "completed" | "failed",
  "current_agent": "ReviewAgent",
  "current_step": 2,
  "total_steps": 4,
  "logs": [
    "æ­£åœ¨åˆ†æ 446 å‰‡ Google è©•è«–...",
    "å·²è™•ç† 234 å‰‡ï¼Œç™¼ç¾ 23 æ¬¡ã€Œå¿…é»ã€"
  ],
  "created_at": "2025-11-29T10:00:00Z",
  "updated_at": "2025-11-29T10:00:05Z"
}
```

---

### 3.2 å‰ç«¯æ”¹é€ 

#### æ–°å¢å…ƒä»¶
- `components/agent-focus-loader.tsx`
- `components/agent-card.tsx`
- `components/trivia-card.tsx`

#### Polling æ©Ÿåˆ¶
```typescript
useEffect(() => {
  const interval = setInterval(async () => {
    const res = await fetch(`/v2/recommendations/progress/${jobId}`);
    const data = await res.json();
    
    if (data.current_agent !== currentAgent) {
      // Agent åˆ‡æ›ï¼Œè§¸ç™¼å‹•ç•«
      setCurrentAgent(data.current_agent);
    }
    
    setLogs(data.logs);
    
    if (data.status === 'completed') {
      clearInterval(interval);
      router.push('/recommendation/result');
    }
  }, 1000); // æ¯ç§’ Polling
  
  return () => clearInterval(interval);
}, [jobId]);
```

---

## 4. å‹•ç•«è¨­è¨ˆ

### 4.1 å‘¼å¸ç‡ˆæ•ˆæœ
```css
@keyframes pulse {
  0%, 100% { 
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    transform: scale(1);
  }
  50% { 
    box-shadow: 0 0 40px rgba(59, 130, 246, 0.8);
    transform: scale(1.05);
  }
}

.breathing-dot {
  animation: pulse 2s infinite;
}
```

### 4.2 å¡ç‰‡åˆ‡æ›å‹•ç•«
```css
/* æ»‘å‡º */
@keyframes slideOutLeft {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(-100%); opacity: 0; }
}

/* æ»‘å…¥ */
@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
```

### 4.3 å°çŸ¥è­˜æ·¡å…¥æ·¡å‡º
```css
@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(10px); }
  10%, 90% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-10px); }
}
```

---

## 5. ä½¿ç”¨è€…é«”é©—æµç¨‹

### 5.1 ç†æƒ³æƒ…å¢ƒï¼ˆ15 ç§’ï¼‰
```
0s:  ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œé–‹å§‹ç”Ÿæˆæ¨è–¦ã€
1s:  é¡¯ç¤º VisualAgent å¡ç‰‡
     Log: "é–‹å§‹æƒæèœå–®ç…§ç‰‡..."
3s:  Log: "å·²è¾¨è­˜ 20 é“èœå“..."
5s:  VisualAgent å®Œæˆï¼Œåˆ‡æ›åˆ° ReviewAgent
     Log: "æ­£åœ¨åˆ†æ 446 å‰‡è©•è«–..."
8s:  Log: "å·²è™•ç† 200 å‰‡ï¼Œç™¼ç¾ã€Œå¿…é»ã€é—œéµå­—..."
11s: ReviewAgent å®Œæˆï¼Œåˆ‡æ›åˆ° SearchAgent
     Log: "æ­£åœ¨æœå°‹é£Ÿè¨˜..."
13s: SearchAgent å®Œæˆï¼Œåˆ‡æ›åˆ° Orchestrator
     Log: "æ­£åœ¨è¨ˆç®—æœ€ä½³çµ„åˆ..."
15s: Orchestrator å®Œæˆï¼Œè·³è½‰åˆ°çµæœé 
```

### 5.2 å°çŸ¥è­˜è¼ªæ’­ï¼ˆåŒæ™‚é€²è¡Œï¼‰
```
0s:  é¡¯ç¤ºç¬¬ 1 å‰‡å°çŸ¥è­˜
5s:  åˆ‡æ›åˆ°ç¬¬ 2 å‰‡
10s: åˆ‡æ›åˆ°ç¬¬ 3 å‰‡
15s: å®Œæˆï¼ˆé€šå¸¸çœ‹åˆ° 2-3 å‰‡ï¼‰
```

---

## 6. éåŠŸèƒ½éœ€æ±‚

### 6.1 æ•ˆèƒ½æŒ‡æ¨™
- **Polling é »ç‡**: 1 ç§’ä¸€æ¬¡
- **Firestore å¯«å…¥**: æ¯å€‹ Agent æœ€å¤š 5 æ¬¡
- **å‹•ç•«æµæš¢åº¦**: 60 FPS

### 6.2 å¯é æ€§
- **Polling è¶…æ™‚**: 60 ç§’å¾Œé¡¯ç¤ºéŒ¯èª¤
- **ç¶²è·¯æ–·ç·š**: è‡ªå‹•é‡è©¦ 3 æ¬¡
- **å¾Œç«¯å¤±æ•—**: é¡¯ç¤ºå‹å–„éŒ¯èª¤è¨Šæ¯

### 6.3 å¯è¨ªå•æ€§
- **ARIA æ¨™ç±¤**: æ‰€æœ‰äº’å‹•å…ƒç´ éƒ½æœ‰ `aria-label`
- **éµç›¤å°èˆª**: æ”¯æ´ Tab éµ
- **è¢å¹•é–±è®€å™¨**: å‹•æ…‹æ›´æ–°æœƒè¢«æœ—è®€

---

## 7. æ¸¬è©¦ç­–ç•¥

### 7.1 å–®å…ƒæ¸¬è©¦
- Agent å¡ç‰‡å…ƒä»¶æ¸²æŸ“
- å°çŸ¥è­˜è¼ªæ’­é‚è¼¯
- Polling æ©Ÿåˆ¶

### 7.2 æ•´åˆæ¸¬è©¦
- å®Œæ•´çš„ Agent åˆ‡æ›æµç¨‹
- å¾Œç«¯ Log æ¨é€èˆ‡å‰ç«¯é¡¯ç¤º
- éŒ¯èª¤è™•ç†

### 7.3 è¦–è¦ºæ¸¬è©¦
- å‹•ç•«æµæš¢åº¦
- ä¸åŒè¢å¹•å°ºå¯¸çš„æ’ç‰ˆ
- æ·±è‰²æ¨¡å¼æ”¯æ´

---

## 8. æˆåŠŸæŒ‡æ¨™

- âœ… ä½¿ç”¨è€…èƒ½æ¸…æ¥šçœ‹åˆ°æ¯å€‹ Agent çš„å·¥ä½œå…§å®¹
- âœ… ç­‰å¾…æ™‚é–“æ„Ÿè¦ºæ›´çŸ­ï¼ˆå¿ƒç†å­¸ä¸Šçš„ã€Œæœ‰æ„ç¾©ç­‰å¾…ã€ï¼‰
- âœ… ä½¿ç”¨è€…å­¸åˆ°è‡³å°‘ 2 å‰‡é¤é£²å°çŸ¥è­˜
- âœ… Session Duration å¢åŠ ï¼ˆå› ç‚ºä½¿ç”¨è€…æ›´æŠ•å…¥ï¼‰
- âœ… æ¨è–¦çµæœçš„ä¿¡ä»»åº¦æå‡ï¼ˆå› ç‚ºçœ‹åˆ°äº†åˆ†æéç¨‹ï¼‰

---

*æœ¬è¦æ ¼æ–‡ä»¶å®šç¾©äº† Agent ç„¦é»å¼ Loading ç•«é¢çš„å®Œæ•´è¨­è¨ˆï¼Œç¢ºä¿ä½¿ç”¨è€…é«”é©—èˆ‡æŠ€è¡“å¯¦ä½œçš„ä¸€è‡´æ€§ã€‚*
