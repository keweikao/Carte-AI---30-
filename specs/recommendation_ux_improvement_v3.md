# 推薦頁面 UX 改進規格 v3.0

> **文件類型**: Specification (What & Why)
> **狀態**: ✅ 規劃完成
> **建立日期**: 2025-01-XX
> **最後更新**: 2025-01-XX

---

## 📋 文件目的

本規格定義推薦頁面的互動流程改進，旨在：
1. 簡化使用者決策流程（從「評分」改為「選擇」）
2. 提供即時的價格回饋
3. 支援動態類別系統（中式/日式/美式等）
4. 產出清晰的最終菜單

---

## 🎯 核心需求（What & Why）

### 需求 1：簡化按鈕選項

#### What（要做什麼）
- 將現有的「👍 推薦 / 👎 不推薦」按鈕改為「✅ 我要點這道 / 🔄 換一道」
- 移除「讚/倒讚」的評分概念

#### Why（為什麼）
- **問題**：「推薦/不推薦」是評價系統，不等於「要不要點餐」
- **影響**：使用者可能覺得某道菜很好（👍）但預算不夠不想點，造成語義混淆
- **改善**：「我要點這道」= 明確的點餐決策，符合使用者心智模型

---

### 需求 2：動態價格顯示

#### What（要做什麼）
推薦頁面的價格顯示邏輯：
```
總價 = 所有當前菜品的總價（已選 + 未選）
```

#### 使用者操作情境

**情境 A：初始進入頁面**
```
系統推薦 5 道菜：小籠包 $180 + 紅燒肉 $280 + 炒青菜 $120 + 蛋炒飯 $150 + 酸辣湯 $100
顯示：總價 NT$ 830 · 人均 $415 (2人)
```

**情境 B：使用者選擇第一道菜（小籠包）**
```
動作：點擊「我要點這道」
結果：小籠包標記為「已選」
顯示：總價 NT$ 830（不變） · 人均 $415
說明：只是確定，菜品沒變，價格不變
```

**情境 C：使用者換掉第二道菜（紅燒肉 → 糖醋魚 $220）**
```
動作：點擊「換一道」
結果：紅燒肉消失，糖醋魚加入列表
顯示：總價 NT$ 870（+40） · 人均 $435
說明：換菜導致價格變化
```

**情境 D：繼續確定剩餘菜品**
```
最終：所有菜品都確定
顯示：總價 NT$ 870 · 人均 $435
```

#### Why（為什麼）
- **透明度**：使用者隨時知道「當前菜單總共要花多少錢」
- **即時回饋**：換菜立即看到價格變化
- **符合預期**：「我的菜單總價」比「已選 vs 未選對比」更直觀

---

### 需求 3：類別與數量顯示

#### What（要做什麼）
在推薦頁面顯示：
1. 本次菜單的大類別（冷菜、熱菜、主食等）
2. 每個類別建議點的菜數

#### 顯示範例

**中式餐館（鼎泰豐）**
```
┌────────────────────────────────────────┐
│ 本次菜單組成                            │
├────────────────────────────────────────┤
│ 🥗 冷菜 × 1   🍖 熱菜 × 2              │
│ 🍚 主食 × 1   🥟 點心 × 2              │
├────────────────────────────────────────┤
│ 共 6 道 · 總價 NT$ 1,200 · 人均 $400  │
└────────────────────────────────────────┘
```

**日本料理（壽司郎）**
```
┌────────────────────────────────────────┐
│ 本次菜單組成                            │
├────────────────────────────────────────┤
│ 🍣 刺身 × 2   🍱 壽司 × 3              │
│ 🍜 麵類 × 1   🥘 湯物 × 1              │
├────────────────────────────────────────┤
│ 共 7 道 · 總價 NT$ 1,500 · 人均 $500  │
└────────────────────────────────────────┘
```

#### Why（為什麼）
- **理解菜單結構**：使用者清楚知道「系統推薦了什麼類型的菜」
- **平衡感**：可以快速判斷菜單是否均衡（例如：主食太少、湯品太多）
- **決策輔助**：知道類別後，換菜時有參考依據

---

### 需求 4：動態類別系統

#### What（要做什麼）
類別會根據餐廳類型自動調整：

| 餐廳類型 | 類別範例 |
|---------|---------|
| 中式餐館 | 冷菜、熱菜、主食、湯品、點心 |
| 日本料理 | 刺身、壽司、燒烤、麵類、湯物 |
| 美式餐廳 | 前菜、主餐、配菜、甜點、飲料 |
| 義式料理 | 前菜、義大利麵、披薩、主菜、甜點 |
| 泰式料理 | 開胃菜、咖哩、炒飯麵、湯類、甜品 |

#### Why（為什麼）
- **符合餐廳特性**：不同菜系有不同的菜品組織方式
- **文化適應性**：使用使用者熟悉的分類術語
- **擴充性**：未來可輕鬆新增其他菜系

---

### 需求 5：確定後的視覺回饋

#### What（要做什麼）
使用者點擊「我要點這道」後：
- ~~菜品立即消失~~（原方案，已調整）
- **菜品保持顯示，但變為「半透明」或「標記已選」** （改良方案）

#### Why（為什麼）
- **避免後悔**：使用者可以看到自己選了什麼
- **可比較**：可以隨時檢視已選與未選的菜品
- **可取消**：未來可擴充「取消選擇」功能

---

### 需求 6：產出點餐菜單

#### What（要做什麼）
- 將「完成點餐」按鈕改為「產出點餐菜單」
- 點擊後導航至新的「菜單頁」（/menu）

#### 菜單頁內容
```
┌────────────────────────────────────────┐
│ 您的點餐菜單                            │
├────────────────────────────────────────┤
│ 🥗 涼拌黃瓜          NT$ 80            │
│ 🍖 糖醋魚           NT$ 220           │
│ 🍚 蛋炒飯           NT$ 150           │
│ 🍲 酸辣湯           NT$ 100           │
├────────────────────────────────────────┤
│ 共 4 道                                │
│ 總價 NT$ 550                           │
│ 人均 NT$ 275 (2人)                     │
├────────────────────────────────────────┤
│ [返回修改] [分享菜單] [對推薦評分]     │
└────────────────────────────────────────┘
```

#### Why（為什麼）
- **成果展示**：提供明確的輸出物（可截圖、可分享）
- **儀式感**：「產出菜單」比「完成點餐」更有成就感
- **下一步行動**：菜單頁可以加入分享、修改、評分等功能

---

### 需求 7：保留回饋機制

#### What（要做什麼）
在菜單頁加入簡單的整體滿意度評分：
```
😍 超滿意 | 😊 滿意 | 😐 普通 | 😞 不滿意
```

#### Why（為什麼）
- **資料收集**：雖然移除了逐道評分，但仍需整體滿意度資料
- **AI 迭代**：回饋資料用於改進推薦演算法
- **非侵入式**：放在菜單頁，不干擾點餐流程

---

## 🚫 非功能性需求（Constraints）

### 限制 1：不需要「系統建議 vs 已選」對比
- **移除**：原本的「系統建議總價 vs 當前已選總價」雙重顯示
- **原因**：使用者只需要知道「當前菜單總價」，不需要對比

### 限制 2：菜品不會完全消失
- **調整**：確定後不消失，而是變為半透明或標記
- **原因**：使用者需要看到完整菜單

### 限制 3：所有類別都需要做決定
- **強制**：使用者必須對每道菜做決定（確定或換掉）才能產出菜單
- **原因**：確保菜單完整性

### 限制 4：候選菜品池限制 ⭐ **重要**
- **限制**：換菜時只能從「AI 預先推薦的候選池」中選擇，不是整個餐廳菜單
- **原因**：
  1. 確保推薦品質（每道菜都經過 AI 評估）
  2. 避免推薦不適合的菜品（例如：使用者不吃辣，卻推薦麻辣鍋）
  3. 控制價格範圍（候選池的菜品價格應該接近）
- **實作策略**：混合策略（前端備選池 + API 補充）
  - 初始載入：1 道顯示 + 2-3 道備選
  - 備選用完後：呼叫 API 動態取得更多候選
  - 候選池大小：根據類別特性（熱菜 5 道，冷菜 3 道等）

---

## 📊 資料結構定義

### 菜品項目（MenuItem）
```typescript
interface MenuItem {
    name: string;           // 菜名
    price: number;          // 價格
    category: string;       // 類別（動態）
    reason: string;         // 推薦理由
    review_count: number;   // 評論數
}
```

### 菜品槽位（DishSlot）
```typescript
interface DishSlot {
    category: string;                    // 類別名稱
    currentDish: MenuItem;               // 當前顯示的菜品
    alternatives: MenuItem[];            // 備選菜品池（2-3 道）
    replacedDishes: string[];            // 已經換掉的菜名列表
    status: 'pending' | 'selected';      // 狀態：待選擇 或 已確定
}
```

### API 回應格式（更新：包含候選池）
```typescript
interface RecommendationResponse {
    recommendation_id: string;
    restaurant_info: {
        name: string;
        cuisine_type: string;  // 餐廳類型（中式餐館、日本料理等）
    };
    items: DishSlotResponse[];  // 改為 DishSlotResponse
    category_summary: Record<string, number>;  // 類別統計
    total_price: number;
    per_person: number;
}

interface DishSlotResponse {
    category: string;
    display: MenuItem;         // 顯示的菜品
    alternatives: MenuItem[];  // 備選池（2-3 道）
}
```

---

## 🔄 使用者流程（User Flow）

### 完整流程
```
1. 使用者進入推薦頁
   ↓
2. 看到菜單組成（類別 + 數量）和總價
   ↓
3. 逐一決定每道菜
   ├─ 選項 A：點擊「我要點這道」→ 標記為已選
   └─ 選項 B：點擊「換一道」→ 替換成其他菜品（價格可能變化）
   ↓
4. 所有菜品都決定完
   ↓
5. 點擊「產出點餐菜單」
   ↓
6. 導航至菜單頁（顯示最終選擇）
   ↓
7. 可選：對推薦進行整體評分
   ↓
8. 完成
```

---

## ✅ 成功標準（Success Criteria）

此功能開發完成後，應滿足：

1. ✅ 使用者可以清楚看到菜單組成（類別 + 數量）
2. ✅ 總價隨著換菜即時更新
3. ✅ 確定的菜品有視覺標記（半透明或勾選）
4. ✅ 所有菜品決定完才能產出菜單
5. ✅ 菜單頁顯示最終選擇的所有菜品
6. ✅ 類別圖示根據餐廳類型動態變化

---

## 📝 邊界條件（Edge Cases）

### 情境 1：候選池完全用完
```
問題：使用者連續換了 10 次，備選池和 API 候選池都用完了
處理：
  1. 顯示提示「該類別暫無更多推薦」
  2. 提供選項：
     - [保留當前菜品]
     - [查看之前換掉的菜品]（回溯功能）
```

### 情境 2：換菜後價格劇烈變化
```
問題：從 $180 的菜換成 $350 的菜（價格差異 >50%）
處理：
  1. 顯示價格差異動畫「+$170 ⚠️」（紅色閃爍）
  2. 即時更新總價
  3. 如果總價超預算 >20%，彈出警告對話框
```

### 情境 3：使用者未選完所有菜品
```
問題：還有 2 道菜未決定，但使用者點擊「產出菜單」
處理：按鈕顯示為灰色不可點擊，提示「還有 2 道菜待決定」
```

### 情境 4：備選池價格控制
```
問題：候選池中有菜品價格差異過大（例如：$80 vs $350）
處理（後端）：
  1. 在生成候選池時，過濾價格差異 >100% 的菜品
  2. 確保候選池內價格範圍適中（例如：±30%）
```

### 情境 5：候選池品質門檻
```
問題：候選池中有評分過低的菜品（<3.5 星）
處理（後端）：
  1. 設定最低評分閾值（3.5 星）
  2. 設定最低評論數要求（>10 則）
  3. 確保所有候選都是「可推薦」的品質
```

---

## 🎨 UI/UX 原則

### 原則 1：即時回饋
- 任何操作（確定、換菜）都應該有即時的視覺回饋
- 價格變化應該動畫顯示（例如：+$40 綠色閃爍）

### 原則 2：進度可見
- 顯示「已決定 3/5 道」的進度
- 讓使用者知道還需要做多少決策

### 原則 3：可回溯
- 保留已選菜品的顯示（半透明）
- 未來可擴充「取消選擇」功能

---

## 🔗 相關文件

- `implementation_plan.md`：技術實作計畫（How）
- `task.md`：任務拆解清單
- `ux_improvements_plan_v2.md`：前一版本的規劃（已過時）

---

## 📅 版本歷史

- **v3.0** (2025-01-XX)：根據使用者回饋調整價格邏輯，加入動態類別系統
- **v2.0** (2025-01-XX)：初版讚/倒讚系統規劃（已廢棄）
- **v1.0** (2025-01-XX)：基礎 UX 改進（登入狀態、返回按鈕等）

---

*本規格遵循 Spec-Driven Development 原則，只描述 What & Why，不涉及技術實作細節（How）。*
