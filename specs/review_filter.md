# Review Filter 規格（方案 A：正則過濾）

## 目標與價值
- 以低成本、低風險方式初步降低低品質/疑似假評論對推薦結果的干擾。
- 在 30 分鐘內可落地，並保留未來導入 AI 評分層的擴充空間。

## 範圍 (In Scope)
- 為 Google Places 拉回的評論新增一層「過濾」處理，輸出被保留的評論清單與統計。
- 規則型過濾：文字長度、重複字元/符號、關鍵詞與 pattern（正則），以及最低保留數的退場機制。
- Logging：記錄總數、過濾數、保留數，並標記樣本供抽查。

## 不在範圍 (Out of Scope)
- AI 評分或 Embedding；多語系精緻規則；前端標示過濾數量；Dashboard。

## 觸發點與資料流
- 觸發：`services/google_places_service.py` 內的 `fetch_place_details()` 在獲得評論陣列後呼叫過濾器。
- 輸入：評論列表（含文字、語言、rating、timestamp 等原始欄位）。
- 輸出：`filtered_reviews`（保留的評論）與 `filter_stats`（原始數、過濾數、保留數、被過濾樣本片段）。

## 規則草案（可調）
- 長度：`len(text) < 6` 或 `len(text) > 800` 視為可疑，預設過濾。
- 重複/灌水 pattern：例如連續 6+ 相同符號或字元（`([\\p{Han}\\w])\\1{5,}`）、大量表情符號/符號佔比 > 0.5。
- 關鍵詞黑名單（繁中/中英混雜，之後可外部化）：如「好評返現」「有償好評」「刷單」「五星送」「置評」「返點」等。
- 垃圾符號噪音：全符號或空白（`^[\\p{P}\\s]+$`）直接過濾。
- 語言：暫不做語言偵測，預設針對繁中常見假評特徵。
- 最低保留數：若過濾後 < `min_keep`（預設 30），則放寬：優先恢復長度邊界型（非黑名單）評論直到達標。

## Logging 與可觀測性
- 每次呼叫輸出 `filter_stats`：`total`, `filtered`, `kept`, `min_keep_used`(bool), `samples`（最多 20 則被過濾評論的摘要，含原因標籤）。
- Logger 層級：info 1 行摘要；debug 可輸出 samples（需避免過長）。

## 邊界情境
- 無評論：直接返回空列表，`filter_stats` 0/0/0。
- 資料缺欄位：缺 text 時視為可疑過濾；空字串過濾。
- 極長評論：截斷後再評估符號比例，避免 OOM，但仍以長度規則判定。

## 驗收與指標
- 功能驗收：`fetch_place_details()` 產物包含過濾後列表與統計；不應改變非評論欄位。
- 效果指標：過濾前後評論數；抽查 20 則被過濾樣本無明顯誤殺；觀察推薦結果是否更合理。

## 風險與緩解
- 過度過濾：預設保守規則；啟用 `min_keep` 回退；定期人工抽查。
- 評論量驟減：若 < 30 則啟動放寬；可調整 `min_keep` 或關鍵詞名單。
- 地區差異：先針對繁中；規則以可配置列表實作，預留多語擴充。

## 未來擴充（方案 B/C 鉤子）
- 外部化規則檔、環境變數調整參數；加入 AI 評分層與 dashboard 前，需要保留 `filter_stats` 資料結構。
