# 開發日誌 - 2025-11-29

## 📝 摘要
本日主要完成了預算限制的移除、推薦流程的優化、效能改進（Golden Profile 快取）以及 UX 的增強（首次訪問提示）。

## 🚀 已完成項目

### 1. 移除預算限制 (Budget Removal)
- **Frontend**:
    - 移除了輸入頁面的預算滑桿和相關邏輯 (`frontend/src/app/input/page.tsx`)。
    - 移除了推薦頁面的預算使用率顯示。
    - 移除了「產出點餐菜單」按鈕的鎖定邏輯，現在允許使用者自由選擇菜品數量。
    - 修正了輸入頁面殘留的預算提示文字。
- **Backend**:
    - 更新了 `DishSelectorAgent` Prompt，不再考慮預算限制。
    - 移除了 `BudgetOptimizerAgent`。
    - 更新了 API Schema，將 `budget` 設為選填。
- **Testing**:
    - 建立了 `test_no_budget.py` 驗證無預算流程。
    - 修正了測試腳本中的欄位名稱錯誤。

### 2. 推薦流程優化 (Recommendation Flow Refinement)
- **Frontend**:
    - 將菜品的預設選取狀態從 `selected` 改為 `pending`，讓使用者手動選擇。
    - 在 `finalizeOrder` 中加入了 `recommended_count` 和 `selected_count` 的統計。
    - 在點擊「產出點餐菜單」時，若未選擇任何菜品會跳出提示。
- **Backend**:
    - 更新 `DishSelectorAgent` Prompt，強制要求使用繁體中文輸出 `dish_name` 和 `reason`。
    - 修正了價格處理邏輯，當價格為 `None` 時預設為 0，避免崩潰。

### 3. 效能優化 (Performance Optimization)
- **Golden Profile Caching**:
    - 修改 `services/firestore_service.py`，支援儲存 `golden_profile` 和 `agent_results`。
    - 修改 `agent/profile_agent.py`，在快取命中且存在 `golden_profile` 時，直接回傳結果，**完全跳過**耗時的 Multi-Agent Analysis (Visual, Review, Search)。
    - 這顯著提升了重複查詢的回應速度（從數十秒降至秒級）。

### 4. UX 增強 (UX Enhancements)
- **首次訪問提示 (First Visit Warm Message)**:
    - 修改 `agent/dining_agent.py` 和 `main.py`，在非同步任務開始時檢查快取狀態。
    - 將 `is_cache_hit` 狀態透過 `metadata` 傳遞給前端。
    - 修改 `frontend/src/components/agent-focus-loader.tsx`，當 `is_cache_hit` 為 `false` 時，顯示「您是第一位探索這家餐廳的美食家！AI 正在進行深度分析...」的溫馨提示。

## 🐛 Bug 修復
- 修正了輸入頁面在移除預算功能後，仍然讀取 URL `budget` 參數導致的邏輯殘留。
- 修正了 `AgentFocusLoader` 中意外刪除 state 的問題。

## 📅 下一步計畫
- 監控 Production 環境的 Cache Hit Rate 和回應時間。
- 收集使用者對於「自由選擇」模式的反饋。
- 考慮進一步優化 `DishSelectorAgent` 的生成速度。
